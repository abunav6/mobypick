<!-- mobypick_app/templates/select_books.html -->
{% extends "base/base.html" %}

{% block content %}
</br>

<ul class="nav nav-tabs" id="genreTabs">
    {% for genre, books in items.items %}
    <li class="nav-item">
    <a class="nav-link {% if forloop.first %}active{% endif %}" id="tab-{{ genre }}" data-toggle="tab" href="#tab-{{genre}}-content">{{genre}}</a>
  </li>
  {% endfor %}
</ul>


<div class="tab-content">
  {% for genre, books in items.items %}
  <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="tab-{{genre}}-content">
    <div class="row">
      {% for book in books %}
        <div id={{book.book_id}} class="col-2" ondblclick="window.open('{{book.url}}', '_blank')">
          <img src="{{ book.image_url }}" alt="Image" class="img-fluid">
          <p>{{ book.title }}</p>
          <p>{{ book.author }}</p>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
  
</div>

<button onclick="submit()" class="cta-button">Submit</button>
<button onclick="skip()" class="cta-button">Skip</button>


<!-- Add this script at the end of your HTML template to enable Bootstrap tabs -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UoV6eT/3HqJ9zzdYPbQU3oHW3I5om/lJ7uS1s7n4C7R2v5Fd8p5Cpy8FZf5A7l6" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script>
  // Add this script to handle tab switching
  $(document).ready(function() {
  
    $('#genreTabs a').on('click', function(e) {
      e.preventDefault();
      let target = $(this).attr('href');
      console.log(target);
      $('.tab-pane').removeClass('show active');
      $(target).addClass('show active');
    });
  });

  var selectedBooks =[];
  var clickCount = 0;
  var clickTimeout;
  var bookDivs = document.querySelectorAll('.col-2');
  bookDivs.forEach(function(bookDiv){
    bookDiv.onclick = event => {
      clickCount++;
   if (clickCount === 1) {
      clickTimeout = setTimeout(function() {
          clickCount = 0;
          console.log('Single click event triggered');
          var bookID = bookDiv.getAttribute("id");

          var index = selectedBooks.findIndex(selectedBookID => selectedBookID=== bookID);
          if (index === -1) {
            // Add book to the list
            selectedBooks.push(bookID);

            // Apply styles for selection
            bookDiv.style.opacity = '0.5';
            bookDiv.style.backgroundColor = 'blue';

            // Create and append a check mark element
            var checkMark = document.createElement('span');
            checkMark.innerHTML = '&#10003;'; // Check mark symbol
            checkMark.style.color = 'white';
            checkMark.style.position = 'absolute';
            checkMark.style.top = '50%';
            checkMark.style.left = '50%';
            checkMark.style.transform = 'translate(-50%, -50%)';
            bookDiv.appendChild(checkMark);

          } else {
            // Remove book from the list
            selectedBooks.splice(index, 1);

            // Reset styles
            bookDiv.style.opacity = '';
            bookDiv.style.backgroundColor = '';

            // Remove check mark element
            var checkMark = bookDiv.querySelector('span');
            if (checkMark) {
                bookDiv.removeChild(checkMark);
            }
        }
      }, 250);   
    }else if (clickCount === 2) {
        clearTimeout(clickTimeout);
        clickCount = 0;
    }
  }

});


function submit(){
  console.log(selectedBooks);
  document.cookie="selectedBooks="+selectedBooks+";path=/"
  window.location.href = "{% url 'put_books' %}" 
}

function skip(){
  window.location.href = "{% url 'show_recommendations' %}";
}

</script>


{% endblock%}

